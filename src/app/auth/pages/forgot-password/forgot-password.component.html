<!-- src/app/auth/pages/forgot-password/forgot-password.component.html -->
<div class="container d-flex justify-content-center align-items-center vh-100">
  <div class="card shadow-lg border-0 rounded-4 p-4" style="max-width: 450px; width: 100%;">
    
    <!-- Header -->
    <div class="text-center mb-4">
      <img src="./logo (2).png" alt="Logo E-commerce" width="140" height="65" class="mb-2">
      <h4 class="fw-bold">
        <span *ngIf="currentStep === 'email'">Recuperar Contraseña</span>
        <span *ngIf="currentStep === 'code'">Verificar Código</span>
        <span *ngIf="currentStep === 'password'">Nueva Contraseña</span>
      </h4>
      <p class="text-muted small">
        <span *ngIf="currentStep === 'email'">Te enviaremos un código de verificación</span>
        <span *ngIf="currentStep === 'code'">Ingresa el código que enviamos a tu correo</span>
        <span *ngIf="currentStep === 'password'">Crea una nueva contraseña segura</span>
      </p>
    </div>

    <!-- Paso 1: Solicitar código por email -->
    <div *ngIf="currentStep === 'email'">
      <form #emailForm="ngForm" (ngSubmit)="onRequestCode(emailForm)">
        <div class="mb-3">
          <label for="email" class="form-label">Correo electrónico</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            [(ngModel)]="email"
            placeholder="ejemplo@email.com"
            required
            #emailField="ngModel"
          >
          <div class="text-danger small" *ngIf="emailField.invalid && emailField.touched">
            El correo es obligatorio y debe ser válido.
          </div>
        </div>

        <!-- Mensaje de error/éxito -->
        <div *ngIf="errorMessage" class="alert alert-danger small">
          {{ errorMessage }}
        </div>
        <div *ngIf="successMessage && currentStep === 'email'" class="alert alert-success small">
          {{ successMessage }}
        </div>

        <!-- Botón enviar -->
        <button 
          type="submit" 
          class="btn btn-primary w-100 rounded-pill mb-3"
          [disabled]="emailForm.invalid || isLoading">
          <span *ngIf="isLoading">Enviando...</span>
          <span *ngIf="!isLoading">Enviar Código</span>
        </button>
      </form>
    </div>

    <!-- Paso 2: Verificar código -->
    <div *ngIf="currentStep === 'code'">
      <form #codeForm="ngForm" (ngSubmit)="onVerifyCode(codeForm)">
        <div class="mb-3">
          <label for="code" class="form-label">Código de verificación</label>
          <input
            type="text"
            class="form-control text-center"
            id="code"
            name="code"
            [(ngModel)]="code"
            placeholder="000000"
            maxlength="6"
            minlength="6"
            required
            #codeField="ngModel"
            style="letter-spacing: 0.5em; font-size: 1.2rem;"
          >
          <div class="text-danger small" *ngIf="codeField.invalid && codeField.touched">
            El código debe tener exactamente 6 dígitos.
          </div>
        </div>

        <!-- Temporizador -->
        <div class="text-center mb-3" *ngIf="timeRemaining">
          <small class="text-muted">
            <i class="bi bi-clock me-1"></i>
            Código válido por: <strong>{{ timeRemaining }}</strong>
          </small>
        </div>

        <!-- Email de confirmación -->
        <div class="text-center mb-3">
          <small class="text-muted">
            Código enviado a: <strong>{{ email }}</strong>
          </small>
        </div>

        <!-- Mensaje de error/éxito -->
        <div *ngIf="errorMessage" class="alert alert-danger small">
          {{ errorMessage }}
        </div>
        <div *ngIf="successMessage && currentStep === 'code'" class="alert alert-success small">
          {{ successMessage }}
        </div>

        <!-- Botones -->
        <button 
          type="submit" 
          class="btn btn-primary w-100 rounded-pill mb-2"
          [disabled]="codeForm.invalid || isLoading">
          <span *ngIf="isLoading">Verificando...</span>
          <span *ngIf="!isLoading">Verificar Código</span>
        </button>
        
        <button 
          type="button" 
          class="btn btn-outline-secondary w-100 rounded-pill mb-2"
          (click)="goBack()">
          Cambiar Email
        </button>
      </form>
    </div>

    <!-- Paso 3: Nueva contraseña -->
    <div *ngIf="currentStep === 'password'">
      <form #passwordForm="ngForm" (ngSubmit)="onResetPassword(passwordForm)">
        <!-- Nueva contraseña -->
        <div class="mb-3">
          <label for="password" class="form-label">Nueva contraseña</label>
          <input
            type="password"
            class="form-control"
            id="password"
            name="password"
            [(ngModel)]="password"
            placeholder="Mínimo 8 caracteres"
            required
            #passwordField="ngModel"
          >
          <div class="text-danger small" *ngIf="passwordField.invalid && passwordField.touched">
            La contraseña es obligatoria.
          </div>
          <!-- Indicador de fortaleza -->
          <div class="small mt-1" [class]="isPasswordValid() ? 'text-success' : 'text-warning'">
            <i class="bi" [class.bi-check-circle]="isPasswordValid()" [class.bi-exclamation-triangle]="!isPasswordValid()"></i>
            Mínimo 8 caracteres, letras y números
          </div>
        </div>

        <!-- Confirmar contraseña -->
        <div class="mb-3">
          <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
          <input
            type="password"
            class="form-control"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            placeholder="Repite la contraseña"
            required
            #confirmPasswordField="ngModel"
          >
          <div class="text-danger small" *ngIf="confirmPasswordField.invalid && confirmPasswordField.touched">
            Confirma tu contraseña.
          </div>
          <!-- Indicador de coincidencia -->
          <div class="small mt-1" *ngIf="confirmPassword" [class]="password === confirmPassword ? 'text-success' : 'text-danger'">
            <i class="bi" [class.bi-check-circle]="password === confirmPassword" [class.bi-x-circle]="password !== confirmPassword"></i>
            <span *ngIf="password === confirmPassword">Las contraseñas coinciden</span>
            <span *ngIf="password !== confirmPassword">Las contraseñas no coinciden</span>
          </div>
        </div>

        <!-- Mensaje de error/éxito -->
        <div *ngIf="errorMessage" class="alert alert-danger small">
          {{ errorMessage }}
        </div>
        <div *ngIf="successMessage && currentStep === 'password'" class="alert alert-success small">
          {{ successMessage }}
          <div class="mt-2">
            <small>Redirigiendo al login en unos segundos...</small>
          </div>
        </div>

        <!-- Botones -->
        <button 
          type="submit" 
          class="btn btn-primary w-100 rounded-pill mb-2"
          [disabled]="passwordForm.invalid || !isPasswordValid() || password !== confirmPassword || isLoading">
          <span *ngIf="isLoading">Cambiando contraseña...</span>
          <span *ngIf="!isLoading">Cambiar Contraseña</span>
        </button>
        
        <button 
          type="button" 
          class="btn btn-outline-secondary w-100 rounded-pill mb-2"
          (click)="goBack()">
          Volver
        </button>
      </form>
    </div>

    <!-- Footer con opciones adicionales -->
    <div class="text-center mt-3" *ngIf="currentStep !== 'password' || !successMessage">
      <div class="border-top pt-3">
        <p class="text-muted small mb-2">¿Recordaste tu contraseña?</p>
        <button 
          type="button" 
          class="btn btn-outline-primary rounded-pill me-2"
          routerLink="/auth">
          Iniciar Sesión
        </button>
        <button 
          type="button" 
          class="btn btn-link text-decoration-none small"
          (click)="restartProcess()" 
          *ngIf="currentStep !== 'email'">
          Empezar de nuevo
        </button>
      </div>
    </div>

  </div>
</div>