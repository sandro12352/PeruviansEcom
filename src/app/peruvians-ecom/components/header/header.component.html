<header class="fire-gradient shadow-sm">
  <div class="scroll">
    <div class="scroll-track">
      <!-- Repite suficientes veces para cubrir el ancho y duplica para el ciclo -->
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <!-- Duplicados para efecto infinito -->
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
      <div class="carrusel-item">üöö ENV√çOS GRATIS A TODO EL PER√ö &nbsp; ‚Ä¢ &nbsp;</div>
    </div>
  </div>

  <div class="px-1 py-1">
    <div class="d-flex align-items-center justify-content-evenly header-container">
      
      <!-- Logo y hamburguesa -->
      <!-- HEADER -->
      <div class="d-flex align-items-center">
        <button class="navbar-toggler d-md-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
          aria-controls="offcanvasMenu" aria-label="Toggle navigation">
          <i class="bi bi-list fs-1"></i>
        </button>
        
        <!-- √çcono de men√∫ (solo en escritorio) como dropdown -->
        <div class="dropdown d-none d-md-block">
          <button 
            class="nav-link btn btn-link p-0 d-flex align-items-center menu-icon me-3"
            id="menuDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            type="button">
            <i class="bi bi-list fs-2"></i>
            <span style="font-weight: 200px;font-size: 1.5rem;margin-left: 10px;">Men√∫</span>
          </button>

          <div class="dropdown-menu custom-width p-3" aria-labelledby="menuDropdown" 
               style="width: 99.2vw;height: 50vh;background-color: #fffffff2;"
               (mouseleave)="ocultarProductos()">
            <div class="d-flex">
              <!-- Categor√≠as (izquierda) - Usando categor√≠as de la API -->
              <ul class="list-unstyled me-4 categories-menu" style="width: 40%;">
                <h2 class="fs-5">CATEGOR√çAS</h2>
                <li *ngFor="let categoria of categorias" 
                    class="category-item" 
                    [attr.data-products]="'products-' + categoria.id"
                    (mouseenter)="mostrarProductos(categoria.id.toString(), categoria.nombre)"
                    [ngClass]="{ 'active': activeCategory === categoria.id.toString() }"
                    [routerLink]="['/', generarSlugCategoria(categoria.nombre)]">
                  {{ categoria.nombre }}
                  <i class="bi bi-chevron-right ms-2"></i>
                </li>
                
                <!-- Mensaje si no hay categor√≠as -->
                <li *ngIf="categorias.length === 0" class="text-muted">
                  Cargando categor√≠as...
                </li>
              </ul>
              
              <!-- Productos (derecha) -->
              <div class="products-list" style="width: 60%; min-height: 200px; border-left: 1px solid #ddd; padding-left: 20px;">
                <div *ngIf="activeCategory && productosFiltrados.length > 0">
                  <h3>{{ activeCategoryName }}</h3>
                  <ul class="products list-unstyled">
                    <li *ngFor="let producto of productosFiltrados">
                      <!-- CORREGIDO: Usar navegarAProducto en lugar de ruta con categor√≠a -->
                      <a (click)="navegarAProducto(producto)" class="dropdown-item cursor-pointer">
                        {{ producto.titulo }}
                      </a>
                    </li>
                  </ul>
                </div>
                
                <div *ngIf="activeCategory && productosFiltrados.length === 0">
                  <p class="text-muted">No hay productos disponibles en esta categor√≠a</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Logo -->
        <a routerLink="/" class="d-inline-block">
          <img src="logo (2).png" loading="lazy" alt="Logo" width="160" height="65">
        </a>       
      </div>

      <!-- OFFCANVAS MENU M√ìVIL -->
      <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasMenuLabel">Men√∫</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="list-unstyled">
            <li>
              <a routerLink="/" data-bs-dismiss="offcanvas" 
                 class="nav-link border-bottom d-flex justify-content-between align-items-center">
                INICIO<i class="bi bi-chevron-right text-success fs-2"></i>
              </a>
            </li>
            
            <!-- Categor√≠as din√°micas en men√∫ m√≥vil -->
            <li *ngFor="let categoria of categorias">
              <a [routerLink]="['/', generarSlugCategoria(categoria.nombre)]" 
                 data-bs-dismiss="offcanvas" 
                 class="nav-link border-bottom d-flex justify-content-between align-items-center">
                {{ categoria.nombre.toUpperCase() }}
                <i class="bi bi-chevron-right text-success fs-2"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Barra de b√∫squeda -->
        <form class="d-none d-md-flex mx-4 w-50" (ngSubmit)="onSubmit()">
          <div class="input-group w-100 no-gap position-relative">
            <span class="search-icon-rounded">
              <i class="bi bi-search-heart fs-5" style="color: rgba(80, 17, 198, 0.383);"></i>
            </span>
            <input
              class="search-input"
              type="search"
              placeholder="¬øQu√© est√°s buscando hoy?"
              [(ngModel)]="terminoBusqueda"
              name="termino"
              (keyup)="buscar()" />
          </div>
          <!-- Dropdown de sugerencias -->
          <ul *ngIf="terminoBusqueda && productosFiltrados.length > 0" class="dropdown-busqueda">
            <li *ngFor="let producto of productosFiltrados"
                (click)="navegarAProducto(producto); seleccionarProducto(producto)">
              {{ producto.nombre }}
            </li>
          </ul>
        </form>

      <!-- √çconos -->
      <!-- Solo la secci√≥n del bot√≥n de usuario - reemplaza la parte correspondiente en tu header.component.html -->

<!-- Bot√≥n de ingresar / Usuario logueado -->
  <div class="d-flex align-items-center gap-4">
  
  <!-- Si no est√° autenticado -->
  <a 
    *ngIf="!isAuthenticated"
    routerLink="/auth" 
    class="d-flex align-items-center text-decoration-none text-dark icon-hover">
    <i class="bi bi-person-circle fs-3 me-2 text-white"></i>
    <span class="fw-semibold">Ingresa</span>
  </a>
  <div *ngIf="isAuthenticated" class="dropdown">
  <button 
    class="d-flex align-items-center icon-hover btn btn-link p-0 text-white text-decoration-none"
    id="userDropdown"
    data-bs-toggle="dropdown"
    data-bs-auto-close="true"
    data-bs-display="static"
    aria-expanded="false"
    type="button">
    <i class="bi bi-person-circle fs-3 me-2"></i>
    <span class="fw-semibold user-name" [title]="clienteNombre || 'Usuario'">
      {{ getShortName() }}
    </span>
    <i class="bi bi-chevron-down ms-1"></i>
  </button>

  <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0" aria-labelledby="userDropdown">
    <li>
      <a routerLink="perfil" class="dropdown-item py-2" data-bs-dismiss="dropdown">
        <i class="bi bi-person me-2"></i>
        <span>Mi Cuenta</span>
      </a>
    </li>
    <li>
      <a routerLink="mis-pedidos" class="dropdown-item py-2" data-bs-dismiss="dropdown">
        <i class="bi bi-bag me-2"></i>
        <span>Mis Pedidos</span>
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <button class="dropdown-item py-2 text-danger border-0 bg-transparent w-100 text-start" (click)="logout()">
        <i class="bi bi-box-arrow-right me-2"></i>
        <span>Cerrar Sesi√≥n</span>
      </button>
    </li>
  </ul>
</div>

    <!-- Carrito (mantener como est√°) -->
    <a type="button" class="position-relative text-dark icon-hover" 
      data-bs-toggle="offcanvas" data-bs-target="#offcanvasCarrito" aria-controls="offcanvasCarrito">
      <i class="bi bi-cart fs-3 text-white"></i>
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-dark">
        {{ cartCount }}
        <span class="visually-hidden">productos en el carrito</span>
      </span>
    </a>
  </div>

      <!-- Offcanvas del carrito -->
      <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasCarrito" #offcanvasRef aria-labelledby="offcanvasCarritoLabel" style="width: 530px;">
        <div class="offcanvas-header">
          <h5 id="offcanvasCarritoLabel">Carrito</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>

        <!-- Contenedor con scroll -->
        <div class="offcanvas-body p-0 d-flex flex-column justify-content-between" *ngIf="productosEnCarrito.length > 0; else carritoVacio">
          <div class="overflow-auto px-3 py-2">
            <div *ngFor="let producto of productosEnCarrito" class="mb-3 border rounded p-2 position-relative">
              
              <div class="d-flex gap-3">
                <!-- Imagen -->
                <div style="width: 120px; height: 120px; flex-shrink: 0;">
                  <img [src]="producto.img" class="img-fluid rounded" alt="producto" style="object-fit: cover; width: 100%; height: 100%;">
                </div>

                <!-- Informaci√≥n -->
                <div class="flex-grow-1">
                  <div class="d-flex justify-content-between align-items-start gap-2">
                    <div class="flex-grow-1">
                      <div class="producto-titulo">
                        {{ producto.titulo }}
                      </div>
                      <small class="text-muted">{{ producto.tienda }}</small>
                    </div>
                    <div class="cursor-pointer">
                      <button type="button" class="btn p-0 border-0 bg-transparent" (click)="eliminarProducto(producto)" aria-label="Eliminar producto">
                        <i class="bi bi-trash3-fill fs-5 text-danger"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Contador de cantidad -->
                  <div class="cantidad-box d-flex align-items-center justify-content-between my-1 px-2 py-1">
                    <button class="cantidad-btn" (click)="disminuirCantidad(producto)">‚àí</button>
                    <span>{{ producto.cantidad }}</span>
                    <button class="cantidad-btn" (click)="aumentarCantidad(producto)">+</button>
                  </div>

                  S/. {{ producto.precio | number:'1.2-2' }}<br>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Resumen fijo abajo -->
          <div class="resumen-footer border-top bg-white p-3">
            <div class="d-flex justify-content-between">
              <span>Subtotal:</span>
              <span>S/. {{ calcularSubtotal() | number:'1.2-2' }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>Descuento:</span>
              <span>S/. {{ calcularDescuento() | number:'1.2-2' }}</span>
            </div>
            <hr class="my-2">
            <div class="d-flex justify-content-between fw-bold">
              <span>Total:</span>
              <span>S/. {{ calcularTotal() | number:'1.2-2' }}</span>
            </div>
            <div class="d-grid mt-3">
              <button class="btn btn-finalizar-compra" (click)="irACheckout()">
                üõí Finalizar compra
              </button>
            </div>
          </div>
        </div>

        <ng-template #carritoVacio>
          <div class="d-flex flex-column justify-content-center align-items-center" style="height: 100%;">
            <i class="bi bi-cart-x fs-1 text-muted"></i>
            <p class="mt-3 text-muted fs-5">No tiene productos agregados en el carrito.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Navbar secundaria -->
  <nav class="navbar navbar-expand-md chicha-navbar-minimal shadow-sm" style="background: #fff;">
    <div class="container-fluid">
      <div class="collapse navbar-collapse justify-content-center" id="mainNavbar">
        <ul class="navbar-nav flex-row gap-4 d-none d-md-flex align-items-center">
          <li class="nav-item">
            <a [routerLink]="['mas-vendidos']" class="nav-link">
              <strong>M√ÅS VENDIDO</strong>
            </a>
          </li>
          <li class="nav-item">
            <a [routerLink]="['mas-nuevos']" class="nav-link">
              <strong>NOVEDADES</strong>
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="blog" class="nav-link">
              <strong>BLOG</strong>
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="ofertas" class="nav-link">
              <strong>PROMOCIONES</strong>
            </a>
          </li>
          <li class="nav-item">
            <a [routerLink]="['contactanos']" class="nav-link">
              <strong>CONT√ÅCTANOS</strong>
            </a>
          </li>
        </ul>
      </div>

      <!-- B√∫squeda en m√≥vil -->
    <form class="d-md-none w-100 mt-3" (ngSubmit)="onSubmit()">
      <div class="input-group w-100 no-gap position-relative">
        <span class="search-icon-rounded">
          <i class="bi bi-search-heart fs-5" style="color: rgba(80, 17, 198, 0.383);"></i>
        </span>
        <input
          class="search-input"
          type="search"
          placeholder="¬øQu√© est√°s buscando hoy?"
          [(ngModel)]="terminoBusqueda"
          name="termino"
          (keyup)="buscar()" />
      </div>
      <!-- Dropdown de sugerencias -->
      <ul *ngIf="terminoBusqueda && productosFiltrados.length > 0" class="dropdown-busqueda">
        <li *ngFor="let producto of productosFiltrados"
            (click)="navegarAProducto(producto); seleccionarProducto(producto)">
          {{ producto.nombre }}
        </li>
      </ul>
    </form>
      
    </div>
  </nav>
</header>