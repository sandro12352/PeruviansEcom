<section *ngIf="categoria || nombreCategoriaActual" style="background: linear-gradient(to right, #f7971e, #ffd200);">  
  <div class="text-center text-white">
    <h2 class="p-5 text-capitalize">
      {{ nombreCategoriaActual || categoria.replace('-', ' ') }}
      <small class="d-block mt-2" *ngIf="categoriaPadreId">
      </small>
    </h2>
  </div>
</section>

<app-breadcrumb
 [nombreCategoriaActual]="nombreCategoriaActual"
 [nombreCategoriaHijo]="nombreCategoriaHijo"
 [nombreEtiqueta]="nombreEtiqueta"
></app-breadcrumb>




<section class="container-fluid ">
  <div class="row px-4">
    <!-- Sidebar -->
    <div class="col-lg-3 mb-4">
      <div class="card p-3">
        <h5 class="mb-3">Filtrar por:</h5>

        <div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="filtroEstado" id="todos" 
                   value="" (change)="onFiltroEstadoChange($event)" [checked]="filtroSeleccionado === ''" />
            <label class="form-check-label" for="todos">Todos</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="filtroEstado" id="oferta" 
                   value="oferta" (change)="onFiltroEstadoChange($event)" />
            <label class="form-check-label" for="oferta">En oferta</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="filtroEstado" id="masVendidos" 
                   value="masVendidos" (change)="onFiltroEstadoChange($event)" />
            <label class="form-check-label" for="masVendidos">Lo más vendidos</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="filtroEstado" id="masNuevos" 
                   value="masNuevos" (change)="onFiltroEstadoChange($event)" />
            <label class="form-check-label" for="masNuevos">Lo más nuevos</label>
          </div>
        </div>

        <!-- Precio -->
        <h6 class="mt-4">Precio</h6>
        <div class="range-slider position-relative">
          <input 
            type="range" 
            class="form-range" 
            [min]="precioMin" 
            [max]="precioMax" 
            step="100" 
            [value]="precioMinActual" 
            id="precioMin"
            (input)="onPrecioMinChange($event)">
          <input 
            type="range" 
            class="form-range" 
            [min]="precioMin" 
            [max]="precioMax" 
            step="100" 
            [value]="precioMaxActual" 
            id="precioMax"
            (input)="onPrecioMaxChange($event)">
        </div>

        <div class="d-flex justify-content-between mt-2">
          <span>Mín: S/ {{ precioMinActual }}</span>
          <span>Máx: S/ {{ precioMaxActual }}</span>
        </div>

        <!-- Filtro de tiendas -->
        <h6 class="mt-4">Tiendas</h6>
        <div>
          <div class="form-check" *ngFor="let tienda of tiendas">
            <input class="form-check-input"
                   type="checkbox"
                   [id]="'tienda-' + tienda.id"
                   [value]="tienda.id"
                   [checked]="tiendasSeleccionadas.includes(tienda.id)"
                   (change)="toggleTiendaSeleccionada(tienda.id)" />
            <label class="form-check-label" [for]="'tienda-' + tienda.id">
              {{ tienda.nombre }}
            </label>
          </div>
        </div>

        <div *ngIf="tiendas.length === 0" class="text-muted">
          Cargando tiendas...
        </div>

      </div>
    </div>

    <!-- Productos -->
    <div class="col-lg-9">
      <!-- Skeletons mientras carga -->
      <div class="row gx-3 gy-4" *ngIf="isLoading">
        <div class="col-6 col-sm-6 col-md-4 col-lg-3" *ngFor="let i of skeletonArray">
          <div class="card h-100 p-3 skeleton"></div>
        </div>
      </div>

      <!-- Productos cuando termina de cargar - ACTUALIZADO -->
      <div class="row gx-3 gy-4" *ngIf="!isLoading">
        <div class="col-6 col-sm-6 col-md-4 col-lg-3" *ngFor="let producto of productos">
          <!-- CAMBIO PRINCIPAL: Pasar la ruta calculada -->
          <app-card 
            [producto]="producto" 
            [rutaProducto]="generarRutaParaProducto(producto)">
          </app-card>
        </div>
      </div>

      <!-- Mensaje cuando no hay productos -->
      <div *ngIf="!isLoading && productos.length === 0" class="text-center py-5">
        <p class="text-muted">No se encontraron productos con los filtros seleccionados.</p>
      </div>
    </div>
  </div>
</section>